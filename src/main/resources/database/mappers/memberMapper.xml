<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dg.s10.member.MemberDAO">
	<resultMap type="MemberDTO" id="getLoginResult">
      <id column="id" property="id"/>
      <result column="pw" property="pw"/>
      <result column="name" property="name"/>
      <result column="phone" property="phone"/>
      <result column="email" property="email"/>
      <!-- 1:1관계, DTO내에 다른 DTO 하나가 매개변수로 선언 -->
      <association property="memberFilesDTO" javaType="MemberFilesDTO">
         <id column="num" property="num"/>
         <result column="fileName" property="fileName"/>
         <result column="oriName" property="oriName"/>
      </association>
      
   </resultMap>
	<select id="getFile" parameterType="MemberDTO"
		resultType="MemberFilesDTO">
		SELECT * FROM MEMBERFILES WHERE ID=#{id}
	</select>

	<select id="getLogin" parameterType="MemberDTO" resultMap="getLoginResult">
		SELECT *
		FROM MEMBER M
		LEFT JOIN
		MEMBERFILES MF
		USING (ID)
		WHERE ID=#{id} AND PW=#{pw}
	</select>

	<insert id="setFileInsert" parameterType="MemberFilesDTO">
		INSERT INTO MEMBERFILES (NUM, ID, FILENAME, ORINAME) VALUES
		(FILES_SEQ.NEXTVAL, #{id}, #{fileName}, #{oriName})
	</insert>


	<select id="getIdCheck" parameterType="MemberDTO"
		resultType="MemberDTO">
		SELECT ID FROM MEMBER WHERE id=#{id}
	</select>

	<insert id="setJoin" parameterType="MemberDTO">
		INSERT INTO MEMBER(id, pw, name, phone, email)
		VALUES(#{id}, #{pw}, #{name}, #{phone}, #{email})
	</insert>

	<update id="setUpdate" parameterType="MemberDTO">
		UPDATE MEMBER SET PW=#{pw}, PHONE=#{phone}, EMAIL=#{email} WHERE ID=#{id}
	</update>

	<delete id="setDelete" parameterType="MemberDTO">
		DELETE MEMBER WHERE
		ID=#{id} and PW=#{pw}
	</delete>



</mapper>
  